<?xml version="1.0" encoding="UTF-8"?>
<configuration debug="true">

    <!-- ========================= -->
    <!-- Console Appenders -->
    <!-- ========================= -->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
                                    <!--            2가지 필터가 있음-->
                                    <!--            LevelFilter : 그 레벨만 찍는 것-->
                                    <!--            ThresholdFilter : 그 레벨 이상 찍는 것-->
            <level>INFO</level>
        </filter>

        <encoder>

            <charset>
                UTF-8
            </charset>

            <Pattern>%d %5p [%c] %m %n</Pattern>

<!--                    %d            %5p  %c     %m             %n == \n -->
<!--        2025-12-18 09:00:01,042  INFO [A] 서버 시작 완료-->
<!--        2025-12-18 09:00:05,317 DEBUG [B] userId=42, 요청 파라미터 검증 시작-->
<!--        2025-12-18 09:01:12,884  WARN [C] 응답 지연 발생, timeout=3000ms-->
<!--        2025-12-18 09:02:44,109 ERROR [D] DB 연결 실패-->

        </encoder>
    </appender>

    <!-- ========================= -->
    <!-- File Appenders -->
    <!-- ========================= -->

    <!-- DEBUG 전체 로그 -->
    <appender name="FILE-DEBUG" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/app-debug.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/app-debug.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>7</maxHistory>
        </rollingPolicy>

        <encoder>
            <!--한글 인코더라고 하는데 테스트해야함-->
            <charset>
                UTF-8
            </charset>

            <pattern>%d %-5level [%thread] %logger - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- WARN 이상 로그 -->
    <appender name="FILE-WARN" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/app-warn.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/app-warn.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>

        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>WARN</level>
        </filter>

        <encoder>
            <!--한글 인코더라고 하는데 테스트해야함-->
            <charset>
                UTF-8
            </charset>

            <pattern>%d %-5level [%thread] %logger - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- AOP logs (separate files) -->
    <appender name="AOP-AUDIT" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/aop-audit.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/aop-audit.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>14</maxHistory>
        </rollingPolicy>

        <encoder>
            <charset>
                UTF-8
            </charset>
            <pattern>%d %-5level [%thread] %logger - %msg%n</pattern>
        </encoder>
    </appender>

    <appender name="AOP-TIMING" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/aop-timing.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/aop-timing.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>14</maxHistory>
        </rollingPolicy>

        <encoder>
            <charset>
                UTF-8
            </charset>
            <pattern>%d %-5level [%thread] %logger - %msg%n</pattern>
        </encoder>
    </appender>

    <appender name="AOP-CACHE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/aop-cache.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/aop-cache.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>14</maxHistory>
        </rollingPolicy>

        <encoder>
            <charset>
                UTF-8
            </charset>
            <pattern>%d %-5level [%thread] %logger - %msg%n</pattern>
        </encoder>
    </appender>

    <appender name="AOP-RATELIMIT" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/aop-ratelimit.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/aop-ratelimit.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>14</maxHistory>
        </rollingPolicy>

        <encoder>
            <charset>
                UTF-8
            </charset>
            <pattern>%d %-5level [%thread] %logger - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- ========================= -->
    <!-- Loggers -->
    <!-- ========================= -->

    <logger name="board" level="DEBUG" appender-ref="console"/>

    <logger name="jdbc.sqlonly" level="WARN" appender-ref="console-infolog"/>
    <logger name="jdbc.resultsettable" level="WARN" appender-ref="console-infolog"/>
    <logger name="log4jdbc.log4j2" level="WARN"/>

    <logger name="app.common.aop.ApiAuditAspect" level="INFO" additivity="false">
        <appender-ref ref="console"/>
        <appender-ref ref="AOP-AUDIT"/>
    </logger>
    <logger name="app.common.aop.ApiTimingAspect" level="INFO" additivity="false">
        <appender-ref ref="console"/>
        <appender-ref ref="AOP-TIMING"/>
    </logger>
    <logger name="app.common.aop.ApiCacheAspect" level="INFO" additivity="false">
        <appender-ref ref="console"/>
        <appender-ref ref="AOP-CACHE"/>
    </logger>
    <logger name="app.common.aop.ApiRateLimitAspect" level="INFO" additivity="false">
        <appender-ref ref="console"/>
        <appender-ref ref="AOP-RATELIMIT"/>
    </logger>

    <logger name="org.springframework" level="ERROR"/>
    <logger name="org.springframework.jdbc" level="ERROR"/>

    <!-- ========================= -->
    <!-- Root Logger -->
    <!-- ========================= -->
    <root level="DEBUG">
        <appender-ref ref="console"/>
        <appender-ref ref="FILE-DEBUG"/>
        <appender-ref ref="FILE-WARN"/>
    </root>

</configuration>
